/*! simple-drawing-board / @version:1.2.2 @author:leader22 @license:MIT */ 
!function(t,i){"use strict";function e(t,i){this._ensureEl(t),this.ev=new e.util.Eve,this.el=t,this.ctx=t.getContext("2d"),this._elRect=e.util.getAdjustedRect(t),this._isDrawing=0,this._timer=null,this._coords={old:{x:0,y:0},oldMid:{x:0,y:0},current:{x:0,y:0}},this._settings={lineColor:null,lineSize:null,boardColor:null,historyDepth:null,isTransparent:null,isDrawMode:null},this._history={items:null,idx:null},this._initHistory(),this._initBoard(i)}function s(t){return this.ctx.lineWidth=0|t||1,this}function o(t){return this.ctx.strokeStyle=t,this}function n(t){return this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this._saveHistory(),this}function r(){var t=this._settings;if(t.isTransparent){var i=this.ctx.globalCompositeOperation;this.ctx.globalCompositeOperation="destination-out",this.fill(this._settings.boardColor),this.ctx.globalCompositeOperation=i}else this.fill(this._settings.boardColor);return this._saveHistory(),this}function a(){var t=this._settings;return t.isDrawMode?(this.setLineColor(t.boardColor),t.isTransparent&&(this.ctx.globalCompositeOperation="destination-out"),t.isDrawMode=0):(this.setLineColor(t.lineColor),t.isTransparent&&(this.ctx.globalCompositeOperation="source-over"),t.isDrawMode=1),this.ev.trigger("toggleMode",t.isDrawMode),this}function c(){return this.ctx.canvas.toDataURL("image/png")}function h(t,i){return i=i||!1,"string"==typeof t?this._setImgByImgSrc(t,i):this._setImgByDrawableEl(t,i),this._saveHistory(),this}function l(){this._restoreFromHistory(!1)}function u(){this._restoreFromHistory(!0)}function d(){this._unbindEvents(),e.util.cAF(this._timer),this._timer=null,this._initHistory(),this.ev.trigger("dispose")}function g(t){if(!t||"object"!=typeof t||"canvas"!==t.tagName.toLowerCase())throw new Error("Pass canvas element as first argument.")}function m(t){var i=this._settings=e.util.Const.settings;if(t)for(var s in t)i[s]=t[s];e.util.isTransparent(i.boardColor)&&(i.boardColor="rgba(0,0,0,1)",i.isTransparent=1),i.isDrawMode=1,this.ctx.lineCap=this.ctx.lineJoin="round",this.setLineSize(i.lineSize),this.setLineColor(i.lineColor),this.clear(),this._bindEvents(),this._draw()}function f(){this._bindOrUnbindEvents(!0)}function _(){this._bindOrUnbindEvents(!1)}function p(t){for(var i=e.util.isTouch?["touchstart","touchmove","touchend","touchcancel","gesturestart"]:["mousedown","mousemove","mouseup","mouseout"],s=t?"addEventListener":"removeEventListener",o=0,n=i.length;n>o;o++)this.el[s](i[o],this,!1)}function v(){var t=this._coords.old.x===this._coords.current.x&&this._coords.old.y===this._coords.current.y;if(this._isDrawing&&!t){var i=this._getMidInputCoords(this._coords.current);this.ctx.beginPath(),this.ctx.moveTo(i.x,i.y),this.ctx.quadraticCurveTo(this._coords.old.x,this._coords.old.y,this._coords.oldMid.x,this._coords.oldMid.y),this.ctx.stroke(),this._coords.old=this._coords.current,this._coords.oldMid=i,this.ev.trigger("draw",this._coords.current)}this._timer=e.util.rAF(this._draw.bind(this))}function x(t){this._isDrawing=1;var i=this._getInputCoords(t);this._coords.current=this._coords.old=i,this._coords.oldMid=this._getMidInputCoords(i)}function b(t){this._coords.current=this._getInputCoords(t)}function y(){this._isDrawing=0,this._saveHistory()}function C(t){switch(t.preventDefault(),t.stopPropagation(),t.type){case"mousedown":case"touchstart":this._onInputDown(t);break;case"mousemove":case"touchmove":this._onInputMove(t);break;case"mouseup":case"mouseout":case"touchend":case"touchcancel":case"gesturestart":this._onInputUp()}}function w(t){var i,s;return e.util.isTouch?(i=t.touches[0].pageX,s=t.touches[0].pageY):(i=t.pageX,s=t.pageY),{x:i-this._elRect.left,y:s-this._elRect.top}}function I(t){return{x:this._coords.old.x+t.x>>1,y:this._coords.old.y+t.y>>1}}function D(t,i){var e=this.ctx,s=e.globalCompositeOperation,o=new Image;o.onload=function(){e.globalCompositeOperation="source-over",i||e.clearRect(0,0,e.canvas.width,e.canvas.height),e.drawImage(o,0,0,e.canvas.width,e.canvas.height),e.globalCompositeOperation=s},o.src=t}function E(t,i){if(e.util.isDrawableEl(t)){var s=this.ctx,o=s.globalCompositeOperation;s.globalCompositeOperation="source-over",i||s.clearRect(0,0,s.canvas.width,s.canvas.height),s.drawImage(t,0,0,s.canvas.width,s.canvas.height),s.globalCompositeOperation=o}}function M(){this._history={items:[],idx:0}}function O(){var t=this._history,i=this.getImg(),e=t.items[t.items.length-1];if(!e||i!==e){for(;t.items.length>=this._settings.historyDepth;)t.items.shift(),t.idx--;0!==t.idx&&t.idx<t.items.length?(t.items=t.items.slice(0,t.idx),t.idx++):t.idx=t.items.length+1,t.items.push(i),this.ev.trigger("save",i)}}function T(t){var e=this._history;if(!(t&&e.idx===e.items.length||!t&&1===e.idx)){var s=t?e.idx+1:e.idx-1;e.items.length&&e.items[s-1]!==i&&(e.idx=s,this.setImg(e.items[s-1]))}}e.prototype={constructor:e,setLineSize:s,setLineColor:o,fill:n,clear:r,toggleMode:a,getImg:c,setImg:h,undo:l,redo:u,dispose:d,handleEvent:C,_ensureEl:g,_initBoard:m,_bindEvents:f,_unbindEvents:_,_bindOrUnbindEvents:p,_onInputDown:x,_onInputMove:b,_onInputUp:y,_draw:v,_getInputCoords:w,_getMidInputCoords:I,_setImgByImgSrc:D,_setImgByDrawableEl:E,_initHistory:M,_saveHistory:O,_restoreFromHistory:T},"process"in t?module.exports=e:"function"==typeof define&&define.amd?define([],function(){return e}):t.SimpleDrawingBoard=e}(this.self||global),function(t,i){"use strict";function e(){return"process"in t?!1:"ontouchstart"in t.document}function s(t){return t=t.replace(/\s/g,""),"transparent"===t?!0:"rgba(0,0,0,0)"===t?!0:!1}function o(t){var i=-1!==["img","canvas","video"].indexOf(t.tagName.toLowerCase());return i}function n(i){var e=i.getBoundingClientRect();return{left:e.left+t.scrollX,top:e.top+t.scrollY}}function r(){return(t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||function(i){t.setTimeout(i,1e3/60)}).bind(t)}function a(){return(t.cancelAnimationFrame||t.webkitCancelAnimationFrame||t.mozCancelAnimationFrame||function(i){t.clearTimeout(i)}).bind(t)}function c(){this._events={}}var h={isTouch:e(),isTransparent:s,isDrawableEl:o,getAdjustedRect:n,rAF:r(),cAF:a(),Eve:c,Const:{settings:{lineColor:"#aaa",lineSize:5,boardColor:"transparent",historyDepth:10}}};c.prototype={constructor:c,on:function(t,i){var e=this._events;t in e||(e[t]=[]),e[t].push(i)},off:function(t,i){var e=this._events;if(t in e){i||(e[t]=[]);var s=e[t].indexOf(i);s>=0&&e[t].splice(s,1)}},trigger:function(t,i){var e,s=this._events;if(t in s)for(var o=0,n=s[t].length;n>o;o++)e=s[t][o],e.handleEvent?e.handleEvent.call(this,i):e.call(this,i)}},"process"in t?module.exports=h:"function"==typeof define&&define.amd?define([],function(){return h}):t.SimpleDrawingBoard.util=h}(this.self||global);